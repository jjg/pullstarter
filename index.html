<!doctype html>
  <head>
    <meta charset="utf-8">
    <title>Pullstarter</title>
    <meta name="description" content="My Parse App">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/styles.css">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.1.8.min.js"></script>
    <script type="text/javascript" src="pullstarter.js"></script>
    <script>

      // init Parse
      Parse.initialize("sGF4JuqzcDyl4TDKKt3U7d3OdPNZG0FZ3TqTuJTr", "OXrMKIkKStgssmijppy8fbfutIvEvUaUOn0dHIwI");

      var Idea = Parse.Object.extend("Idea");

      $(document).ready(function() {
        loadIdeas();
      });

      function loadIdeas(){

        // load & display existing ideas
        var ideaQuery = new Parse.Query(Idea);
        ideaQuery.find({
          success: function(results){

            // display list
            $.each(results, function(key, value){

              ideaQuery.get(value.id, {
                success: function(idea){
                  $("#allideaslist").append("<li onclick=\"loadIdea('" + idea.id + "')\">" + idea.get("title") + "</li>");
                },
              error: function(object, error){
                  console.log(error);
                }
              });
            });
          },
          error: function(error){
            console.log("Error loading ideas: " + error.code + " " + error.message);
          }
        });
      }

      function loadIdea(ideaId){
        console.log("loading idea: " + ideaId);

        var ideaQuery = new Parse.Query(Idea);
        ideaQuery.get(ideaId, {
          success: function(idea){
            $("#ideatitle").html(idea.get("title"));
            $("#ideadescription").html(idea.get("description"));

             //$("#allideaslist").append("<li onclick=\"loadIdea('" + idea.id + "')\">" + idea.get("title") + "</li>");
          },
          error: function(object, error){
              console.log(error);
            }
        });
        //$("#ideatitle").html("foo");
        //$("#ideadescription").html("bar");
      }

      function newIdea(){

        var idea = new Idea();
          idea.save({title:$("#ideaTitle").val(), description:$("#ideaDescription").val()}, {
            
          success: function(object) {
            $("#allideaslist").append("<li onclick='loadIdea(" + idea.id + ")'>" + idea.get("title") + "</li>");
          },
          error: function(model, error) {
            alert("adding idea failed (darn!)");
          }
        });
      }
    </script>
  </head>

  <body>

    <div id="newidea">
      Title: <input id="ideaTitle" type="text"><br>
      Description:<br><textarea id="ideaDescription"></textarea><br>
      <button onclick="newIdea()">add</button>
    </div>

    <div id="allideas">
      all ideas:
      <ul id="allideaslist">
      </ul>
    </div>

    <div id="idea">
      <h3 id="ideatitle"></h3>
      <p id="ideadescription"></p>
    </div>

  </body>
</html>
